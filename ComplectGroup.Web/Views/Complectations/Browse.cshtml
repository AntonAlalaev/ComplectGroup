@using ComplectGroup.Web.Models
@model ComplectationBrowseViewModel
@{
    ViewData["Title"] = "–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏";
}

<div class="container mt-4">
    <h1>@ViewData["Title"]</h1>

    <div class="mb-3">
        <a asp-action="Index" class="btn btn-primary">–°–ø–∏—Å–æ–∫</a>
        <a asp-action="Import" class="btn btn-success me-2">üìä Excel</a>
        <a asp-action="ReportByDates" class="btn btn-primary">–û—Ç—á—ë—Ç</a>
        <a asp-action="Browse" class="btn btn-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
    </div>

    <form method="get" asp-action="Browse" class="row g-3 mb-3">
        <div class="col-md-8">
            <label class="form-label"><strong>–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è</strong></label>
            <select name="id" class="form-select" onchange="this.form.submit()">
                @foreach (var c in Model.Complectations)
                {
                    if (Model.SelectedComplectation != null && c.Id == Model.SelectedComplectation.Id)
                    {
                        <option value="@c.Id" selected>
                            @c.Number - @c.Customer (@c.ShippingDate.ToString("dd.MM.yyyy"))
                        </option>
                    }
                    else
                    {
                        <option value="@c.Id">
                            @c.Number - @c.Customer (@c.ShippingDate.ToString("dd.MM.yyyy"))
                        </option>
                    }
                }

            </select>
        </div>
    </form>

    @if (Model.SelectedComplectation != null)
    {
        <h3>@Model.SelectedComplectation.Number</h3>

        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead class="table-light">
                    <tr>
                        <th>–†–∞–∑–¥–µ–ª</th>
                        <th>–î–µ—Ç–∞–ª—å</th>
                        <th class="text-center">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                        <th class="text-center bg-success text-white">–ù–∞ —Å–∫–ª–∞–¥–µ</th>
                        <th class="text-center bg-info text-white">–û—Ç–≥—Ä—É–∂–µ–Ω–æ</th>
                        <th class="text-center bg-warning text-dark">–ù–∞–¥–æ –æ—Ç–≥—Ä—É–∑–∏—Ç—å</th>
                        <th class="text-center bg-danger text-white">–î–µ—Ñ–∏—Ü–∏—Ç</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var row in Model.PositionDetails)
                    {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ "–î–µ—Ñ–∏—Ü–∏—Ç"
                        string deficitClass = "text-center ";
                        if (row.Deficit == 0)
                            deficitClass += "bg-success text-white";
                        else if (row.Deficit > 0)
                            deficitClass += "bg-danger text-white";
                        else
                            deficitClass += "bg-info text-white";

                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ "–ù–∞ —Å–∫–ª–∞–¥–µ"
                        string warehouseClass = "text-center ";
                        if (row.WarehouseQuantity == 0)
                            warehouseClass += "bg-danger text-white";
                        else if (row.WarehouseQuantity < row.RemainingToShip)
                            warehouseClass += "bg-warning text-dark";
                        else
                            warehouseClass += "bg-success text-white";

                        <tr>
                            <td>@row.Chapter</td>
                            <td>@row.PartName</td>
                            <td class="text-center"><strong>@row.RequiredQuantity</strong></td>
                            <td class="@warehouseClass"><strong>@row.WarehouseQuantity</strong></td>
                            <td class="text-center bg-info text-white"><strong>@row.ShippedQuantity</strong></td>
                            <td class="text-center bg-warning text-dark"><strong>@row.RemainingToShip</strong></td>
                            <td class="@deficitClass"><strong>@row.Deficit</strong></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <p class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
    }
</div>
